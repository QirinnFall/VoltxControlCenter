#!/bin/bash
# Auto Installer VoltxControlCenter - Fixed Version
# Created for VoltXRinn

echo "[âš¡] Memulai instalasi VoltxControlCenter v2.1..."
echo "[!] Pastikan koneksi internet stabil!"

# Clean previous installation
rm -rf ~/VoltxControlCenter 2>/dev/null
rm -rf VoltxControlCenter 2>/dev/null

# Update system
pkg update -y && pkg upgrade -y

# Install dependencies
pkg install -y python python-pip git curl wget nano clang libxml2 libxslt

# Upgrade pip
pip install --upgrade pip setuptools wheel

# Install python modules
pip install requests colorama aiohttp cryptography psutil fake-useragent pycryptodome

# Clone project (gunakan raw link)
git clone https://github.com/QirinnFall/VoltxControlCenter
cd VoltxControlCenter

# Create ALL necessary directories
mkdir -p data/logs
mkdir -p config
mkdir -p modules/__pycache__

# Set permissions
chmod +x menu.py
chmod +x modules/*.py
chmod 755 data data/logs config
chmod 644 requirements.txt INSTALL.txt

# Generate default config
cat > config/settings.cfg << 'EOF'
{
  "api_key": "voltx_rinn_2024",
  "max_threads": 30,
  "ban_timeout": 300,
  "unban_retry": 10,
  "debug_mode": false,
  "auto_update": true,
  "backup_on_start": false,
  "aggressive_mode": true,
  "version": "2.1"
}
EOF

echo '[]' > config/targets.json

# Create test file
cat > test_install.py << 'EOF'
#!/usr/bin/env python3
import sys
import os

print("[âœ…] Testing installation...")

# Test imports
try:
    import requests
    import colorama
    import json
    import threading
    import time
    print("[âœ…] All imports successful")
except Exception as e:
    print(f"[âŒ] Import error: {e}")
    sys.exit(1)

# Test directories
dirs = ['data/logs', 'config', 'modules']
for d in dirs:
    if os.path.exists(d):
        print(f"[âœ…] Directory {d} exists")
    else:
        print(f"[âŒ] Directory {d} missing")

print("\n[âš¡] INSTALLATION COMPLETE!")
print("[ðŸš€] Run: python menu.py")
EOF

chmod +x test_install.py
python test_install.py

echo "[âœ…] Instalasi selesai 100% tanpa error!"
echo "[ðŸš€] Jalankan dengan: cd ~/VoltxControlCenter && python menu.py"
echo "[âš¡] Owner: VoltXRinn | Github: QirinnFall"
